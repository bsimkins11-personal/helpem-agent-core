# Invitation Flow - Complete Example

## Scenario: Sarah invites her friend Mike to "Family Planning" tribe

---

## Step 1: Sarah Opens Tribe Settings

**Screen:** Tribe Detail â†’ Members â†’ + Button

---

## Step 2: Permission Request (First Time Only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚         ğŸ‰ (person icon)            â”‚
â”‚                                     â”‚
â”‚     Invite Someone Special          â”‚
â”‚                                     â”‚
â”‚  Choose someone to join your        â”‚
â”‚  HelpEm tribe. They'll get a        â”‚
â”‚  personal invitation from you       â”‚
â”‚  when they sign up!                 â”‚
â”‚                                     â”‚
â”‚     [Continue Button - Blue]        â”‚
â”‚                                     â”‚
â”‚  No background sync.                â”‚
â”‚  No uploading contacts.             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 3: Contact Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invite to Tribe              [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Search contacts                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Mike Johnson                    â”‚
â”‚     mike.j@email.com              > â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Emily Chen                      â”‚
â”‚     emily@example.com             > â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ David Park                      â”‚
â”‚     (555) 123-4567                > â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Footer: "Your personal invitation will be 
waiting for them when they join HelpEm! 
They'll see it's from you and can choose 
to accept."
```

Sarah taps "Mike Johnson"

---

## Step 4: Set Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invite Member              [Cancel]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SELECT CONTACT                     â”‚
â”‚  âœ“ Contact Selected                 â”‚
â”‚     Mike Johnson                    â”‚
â”‚                                     â”‚
â”‚  Your personal invitation will be   â”‚
â”‚  waiting for them when they join    â”‚
â”‚  HelpEm! They'll see it's from you  â”‚
â”‚  and can choose to accept.          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PERMISSIONS                        â”‚
â”‚  â˜‘ Can Add Tasks                    â”‚
â”‚  â˜ Can Remove Tasks                 â”‚
â”‚  â˜‘ Can Add Routines                 â”‚
â”‚  â˜ Can Remove Routines              â”‚
â”‚  â˜‘ Can Add Appointments             â”‚
â”‚  â˜ Can Remove Appointments          â”‚
â”‚  â˜‘ Can Add Groceries                â”‚
â”‚  â˜ Can Remove Groceries             â”‚
â”‚                                     â”‚
â”‚  Permissions can be updated any     â”‚
â”‚  time after the invite is sent.     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        [Send Invite - Blue]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Sarah taps "Send Invite"

---

## Step 5: Success Confirmation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚     Invitation Ready! ğŸ‰            â”‚
â”‚                                     â”‚
â”‚  Mike Johnson will see your         â”‚
â”‚  personal invitation to join        â”‚
â”‚  'Family Planning' when they        â”‚
â”‚  sign up for HelpEm. They'll be     â”‚
â”‚  excited to collaborate with you!   â”‚
â”‚                                     â”‚
â”‚           [Done - Blue]             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Sarah taps "Done"

---

## Step 6: Tribe Activity Feed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Family Planning - Activity         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‰ Sarah invited Mike Johnson to   â”‚
â”‚     join the tribe!                 â”‚
â”‚     Just now                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Sarah added "Doctor appt" to    â”‚
â”‚     shared calendar                 â”‚
â”‚     2 hours ago                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Backend: What Actually Happens

### 1. API Request
```json
POST /tribes/abc-123/invite-contact
Authorization: Bearer [Sarah's token]

{
  "contactIdentifier": "mike.j@email.com",
  "contactType": "email",
  "contactName": "Mike Johnson",
  "permissions": {
    "canAddTasks": true,
    "canRemoveTasks": false,
    "canAddRoutines": true,
    "canRemoveRoutines": false,
    "canAddAppointments": true,
    "canRemoveAppointments": false,
    "canAddGroceries": true,
    "canRemoveGroceries": false
  }
}
```

### 2. Backend Processing
```javascript
// Normalize email
const normalizedEmail = "mike.j@email.com"

// Get inviter name
const inviterName = "Sarah Wilson" // from getUserDisplayName()

// Create pending invitation
const invitation = {
  id: "inv-456",
  tribeId: "abc-123",
  invitedBy: "user-sarah-id",
  contactIdentifier: "mike.j@email.com",
  contactType: "email",
  contactName: "Mike Johnson",
  inviterName: "Sarah Wilson",
  permissions: { ... },
  state: "pending",
  expiresAt: "2026-02-22T12:00:00Z" // 30 days
}

// Create activity
{
  message: "Sarah Wilson invited Mike Johnson to join the tribe! ğŸ‰"
}
```

### 3. API Response
```json
{
  "success": true,
  "invitation": {
    "id": "inv-456",
    "tribeId": "abc-123",
    "contactIdentifier": "mike.j@email.com",
    "contactName": "Mike Johnson",
    "inviterName": "Sarah Wilson",
    "state": "pending",
    "expiresAt": "2026-02-22T12:00:00Z"
  },
  "inviterName": "Sarah Wilson",
  "message": "Mike Johnson will receive a personal invitation from you to join the Family Planning tribe when they sign up for HelpEm!"
}
```

---

## Future: When Mike Signs Up (Phase 2)

### 1. Mike Downloads HelpEm

```
App Store listing or link from web
```

### 2. Sign in with Apple

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚         Welcome to HelpEm           â”‚
â”‚                                     â”‚
â”‚    Your personal life assistant     â”‚
â”‚                                     â”‚
â”‚    [Continue with Apple - Black]    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Backend Matches Email

```javascript
// Mike signs in, backend gets: mike.j@email.com from Apple

// Check for pending invitations
const pendingInvites = await prisma.pendingTribeInvitation.findMany({
  where: {
    contactIdentifier: "mike.j@email.com",
    state: "pending",
    expiresAt: { gte: new Date() }
  }
});

// Found Sarah's invitation!
// Auto-create TribeMember record
await prisma.tribeMember.create({
  data: {
    tribeId: "abc-123",
    userId: "user-mike-id",
    invitedBy: "user-sarah-id",
    acceptedAt: new Date(),
    permissions: { ... }
  }
});

// Mark invitation as accepted
await prisma.pendingTribeInvitation.update({
  where: { id: "inv-456" },
  data: {
    state: "accepted",
    acceptedAt: new Date(),
    acceptedBy: "user-mike-id"
  }
});
```

### 4. Welcome Screen for Mike

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚      Welcome to HelpEm! ğŸ‰          â”‚
â”‚                                     â”‚
â”‚  Sarah Wilson invited you to join   â”‚
â”‚  "Family Planning"                  â”‚
â”‚                                     â”‚
â”‚  You're all set! You can now:       â”‚
â”‚  â€¢ See shared items                 â”‚
â”‚  â€¢ Add tasks & appointments         â”‚
â”‚  â€¢ Collaborate with Sarah           â”‚
â”‚                                     â”‚
â”‚     [Get Started - Blue]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Sarah Gets Notification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ Mike Johnson joined your        â”‚
â”‚     "Family Planning" tribe!        â”‚
â”‚                                     â”‚
â”‚     [View Tribe]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Updated Activity Feed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Family Planning - Activity         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Mike Johnson joined the tribe!  â”‚
â”‚     Just now                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‰ Sarah invited Mike Johnson to   â”‚
â”‚     join the tribe!                 â”‚
â”‚     5 days ago                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Edge Cases

### Contact Has No Email

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚     Invalid Contact                 â”‚
â”‚                                     â”‚
â”‚  This contact doesn't have an       â”‚
â”‚  email address or phone number.     â”‚
â”‚  Please select a contact with at    â”‚
â”‚  least one of these.                â”‚
â”‚                                     â”‚
â”‚           [OK - Blue]               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Already Invited

```
Backend returns 400:
{
  "error": "An invitation has already been sent to this contact"
}

iOS shows:
"Mike Johnson has already been invited to this tribe."
```

### Invitation Expired (After 30 Days)

```
Database:
state = "expired"

When Mike signs up:
- No auto-join
- Invitation ignored
- Sarah would need to re-invite
```

---

## Key Messaging Principles Applied

1. **Personal Connection**
   - âœ… "Sarah Wilson invited you"
   - âœ… "personal invitation from you"
   - âœ… Shows inviter name everywhere

2. **Clear Expectations**
   - âœ… "when they sign up" (not "we'll send email")
   - âœ… "waiting for them" (stored, not sent yet)
   - âœ… "can choose to accept" (opt-in)

3. **Positive Framing**
   - âœ… "Invitation Ready!" not "Sent"
   - âœ… "Excited to collaborate"
   - âœ… Celebration emojis (ğŸ‰)

4. **Trust Building**
   - âœ… "No background sync"
   - âœ… Shows exactly what info is shared
   - âœ… Permissions explained clearly

5. **Action-Oriented**
   - âœ… Clear CTAs at each step
   - âœ… Progress indication
   - âœ… Immediate feedback
